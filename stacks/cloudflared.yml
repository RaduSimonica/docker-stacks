version: '3.8'
services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    command: tunnel --no-autoupdate run --token ${CLOUDFLARED_TOKEN}
    deploy:
      replicas: 3
      placement:
        constraints:
          - node.role == worker
          - node.labels.os == raspberry-pi
    restart: unless-stopped